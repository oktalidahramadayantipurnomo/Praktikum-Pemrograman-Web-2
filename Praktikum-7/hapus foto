<?php
include('koneksi.php');

// Ambil id yang dikirim
if (!isset($_GET['del'])) {
    echo "ID tidak ditemukan!<br><a href='tampil_foto.php'>Kembali</a>";
    exit;
}

$del = intval($_GET['del']); // pastikan id berupa integer

// Ambil data gambar dari database
$sql_select = "SELECT * FROM namasiswa WHERE id = ?";
$stmt_select = mysqli_prepare($koneksi, $sql_select);
mysqli_stmt_bind_param($stmt_select, "i", $del);
mysqli_stmt_execute($stmt_select);
$result = mysqli_stmt_get_result($stmt_select);
$data = mysqli_fetch_assoc($result);

if (!$data) {
    echo "Data tidak ditemukan!<br><a href='tampil_foto.php'>Kembali</a>";
    exit;
}

// Hapus file gambar dari folder
$gambar_path = "gambar/" . $data['foto'];
if (file_exists($gambar_path)) {
    unlink($gambar_path);
}

// Hapus data dari database
$sql_delete = "DELETE FROM namasiswa WHERE id = ?";
$stmt_delete = mysqli_prepare($koneksi, $sql_delete);
mysqli_stmt_bind_param($stmt_delete, "i", $del);

if (mysqli_stmt_execute($stmt_delete)) {
    echo "Gambar berhasil dihapus<br><a href='tampil_foto.php'>Kembali</a>";
} else {
    echo "Gagal menghapus data: " . mysqli_error($koneksi);
}
?>
